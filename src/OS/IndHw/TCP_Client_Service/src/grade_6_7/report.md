## Отчет на оценки 6-7

В дополнение к программе на предыдущую оценку необходимо разработать отдельную клиентскую программу, подключаемую к серверу, которая предназначена для отображения комплексной информации о выполнении приложения в целом. То есть, данный программный модуль должен адекватно и в полном виде отображать поведение моделируемой системы (информацию передаваемую на сервер и информацию, порождаемую сервером), позволяя не пользоваться отдельными видами, предоставляемыми клиентами и серверами по отдельности.

### Сборка программы

```sh
cd TCP_Client_Service/src/grade_6_7/server && make && cd ../client && make && cd ../logger_client && make
```

### Запуск программы

**Запуск стола-сервера**

```sh
cd server/bin && ./tcp_table_server_6_7 <bind_ip_address> <port>
```

**Запуск клиента-философа**

```sh
cd client/bin && ./tcp_phil_client_6_7 <server_ip_address> <port>
```

**Запуск клиента-логера**

```sh
cd logger_client/bin && ./tcp_log_client_6_7 <server_ip_address> <port>
```

### Видео-демонстрация результатов работы

[Яндекс диск](https://disk.yandex.ru/i/4VqMG7uarNjZAA)


### Описание работы системы логирования

*   **Механизм Логирования на Сервере**: 
    *   **Список Активных Логгеров**: Сервер отслеживает все активные подключения от клиентов-логгеров в специальном массиве (`loggers[]`). Доступ к этому списку синхронизируется с помощью мьютекса (`loggers_mutex`).
    *   **Рассылка Лог-Сообщений**: Сервер реализует функцию (`broadcast_to_loggers`), которая отправляет переданное ей строковое сообщение всем активным клиентам-логгерам.

**2. Взаимодействие и поведение:**

*   **Запуск и подключение Клиента-Логгера**:
    *   Клиентский процесс запускается с указанием IP-адреса и порта сервера.
    *   Клиент-логгер устанавливает TCP-соединение с сервером.
    *   После успешного соединения клиент-логгер отправляет серверу сообщение `MSG_JOIN_LOGGER`.
    *   **Серверный процесс** (в основном потоке `accept`) обрабатывает запрос `MSG_JOIN_LOGGER`:
        *   Сервер проверяет, не превышено ли максимальное количество подключенных логгеров (`active_loggers_count < MAX_LOGGERS`).
        *   Если место есть:
            1.  Сервер добавляет информацию о новом клиенте-логгере в свой список активных логгеров.
            2.  Увеличивает счетчик `active_loggers_count`.
            3.  Отправляет клиенту-логгеру сообщение `RSP_LOGGER_ACCEPTED`.
            4.  Для каждого принятого клиента-логгера сервер создает **отдельный поток** (`handle_logger_client`) для управления его соединением.
            5.  Сервер рассылает сообщение о подключении нового логгера другим уже активным логгерам.
        *   Если мест для логгеров нет, сервер отправляет клиенту-логгеру сообщение `RSP_LOGGER_REJECTED`, и клиентский процесс логгера завершает свою работу.
        *   Если отправка `RSP_LOGGER_ACCEPTED` не удалась (например, клиент-логгер отключился сразу после `MSG_JOIN_LOGGER`), сервер откатывает добавление логгера, закрывает сокет и не создает для него поток.

*   **Работа Клиента-Логгера**:
    *   После получения `RSP_LOGGER_ACCEPTED`, клиент-логгер переходит в режим ожидания.
    *   Он непрерывно читает данные из TCP-сокета, полученные от сервера.
    *   Каждое полученное сообщение выводится на стандартный вывод (консоль) клиента-логгера.
    *   Клиент-логгер не отправляет никаких других сообщений серверу после `MSG_JOIN_LOGGER`.

*   **Отключение Клиента-Логгера**:
    *   Если клиент-логгер закрывает свое соединение или происходит ошибка сети.
    *   Поток `handle_logger_client` на сервере, обслуживающий этого логгера, обнаруживает разрыв соединения (например, `recv` возвращает 0 или ошибку).
    *   Поток `handle_logger_client`:
        1.  Поднимает мьютекс `loggers_mutex`.
        2.  Помечает слот этого логгера как неактивный (`active = 0`).
        3.  Уменьшает счетчик `active_loggers_count`.
        4.  Закрывает серверный сокет, связанный с этим логгером.
        5.  Освобождает мьютекс `loggers_mutex`.
        6.  Завершает свою работу.

*   **Завершение работы Клиента-Логгера**:
    *   **По сигналу (SIGINT/SIGTERM)**:
        1.  Обработчик сигнала на клиенте-логгере устанавливает флаг `logger_client_shutdown_flag`.
        2.  Основной цикл клиента-логгера, обнаружив флаг, выходит из цикла чтения сообщений.
        3.  Клиент-логгер закрывает свое TCP-соединение и завершает работу.
    *   **При получении `MSG_SERVER_DOWN` от сервера**:
        1.  Выводит информацию о завершении работы сервера.
        2.  Устанавливает флаг `logger_client_shutdown_flag` (или напрямую инициирует выход).
        3.  Закрывает TCP-соединение и завершает работу.