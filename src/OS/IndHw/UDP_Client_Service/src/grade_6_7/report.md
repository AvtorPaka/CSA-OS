## Отчет на оценки 6-7

В дополнение к программе на предыдущую оценку необходимо разработать отдельную клиентскую программу, подключаемую к серверу, которая предназначена для отображения комплексной информации о выполнении приложения в целом. То есть, данный программный модуль должен адекватно и в полном виде отображать поведение моделируемой системы (информацию передаваемую на сервер и информацию, порождаемую сервером), позволяя не пользоваться отдельными видами, предоставляемыми клиентами и серверами по отдельности.

### Сборка программы

```sh
cd UDP_Client_Service/src/grade_6_7/server && make && cd ../logger_client && make && cd ../client && make
```

### Запуск программы

**Запуск стола-сервера**

```sh
cd server/bin && ./udp_table_server_6_7 <bind_ip_address> <port>
```

**Запуск клиента-философа**

```sh
cd client/bin && ./udp_phil_client_6_7 <server_ip_address> <port>
```

**Запуск клиента-логера**

```sh
cd logger_client/bin && ./udp_log_client_6_7 <server_ip_address> <port>
```

### Видео-демонстрация результатов работы

[Яндекс диск](https://disk.yandex.ru/i/kA7mA4XUwh1cRw)


### Описание работы системы логирования

*   **Механизм Логирования на Сервере**:
    *   **Список Активных Логгеров**: Сервер отслеживает все активные клиенты-логгеры в специальном массиве (`loggers[]`), храня их **UDP-адреса (IP:порт) и флаг активности**. Доступ к этому списку синхронизируется с помощью мьютекса (`loggers_mutex`).
    *   **Рассылка Лог-Сообщений**: Сервер реализует функцию (`broadcast_to_loggers`), которая отправляет переданное ей строковое сообщение всем активным клиентам-логгерам **по их сохраненным UDP-адресам**.

**2. Взаимодействие и поведение:**

*   **Запуск и "подключение" клиента-логгера**:
    *   Клиентский процесс логгера запускается с указанием IP-адреса и порта сервера. Клиент настраивает таймаут на ожидание ответа от сервера.
    *   Клиент-логгер отправляет серверу **UDP-сообщение** `MSG_JOIN_LOGGER`.
    *   **Основной поток серверного процесса** (обрабатывающий входящие UDP-пакеты) обрабатывает запрос `MSG_JOIN_LOGGER`:
        *   Извлекает **UDP-адрес клиента-логгера** из полученной датаграммы.
        *   Сервер проверяет, не превышено ли максимальное количество подключенных логгеров (`active_loggers_count < MAX_LOGGERS`).
        *   Если место есть:
            1.  Сервер добавляет **UDP-адрес нового клиента-логгера** и устанавливает флаг активности в свой список активных логгеров.
            2.  Увеличивает счетчик `active_loggers_count`.
            3.  Отправляет клиенту-логгеру **UDP-сообщение** `RSP_LOGGER_ACCEPTED` **на его UDP-адрес**.
            4.  *Для UDP не создается отдельный поток `handle_logger_client` для каждого логгера, так как нет постоянного соединения для мониторинга. Управление списком активных логгеров (добавление/удаление) происходит в основном потоке сервера при получении соответствующих команд.*
            5.  Сервер рассылает (через `broadcast_to_loggers`) сообщение о подключении нового логгера другим уже активным логгерам (и самому новому логгеру).
        *   Если мест для логгеров нет, сервер отправляет клиенту-логгеру **UDP-сообщение** `RSP_LOGGER_REJECTED` **на его UDP-адрес**, и клиентский процесс логгера завершает свою работу.
        *   В UDP сервер не может надежно определить, удалась ли отправка `RSP_LOGGER_ACCEPTED`. Если клиент-логгер не получит ответ в течение своего таймаута, он завершит работу.

*   **Работа Клиента-Логгера**:
    *   После получения `RSP_LOGGER_ACCEPTED`, клиент-логгер переходит в режим ожидания.
    *   Он непрерывно пытается читать **UDP-датаграммы** из своего сокета (используя таймаут на чтение).
    *   Каждое полученное сообщение (лог от сервера) выводится на стандартный вывод (консоль) клиента-логгера.
    *   Клиент-логгер не отправляет никаких других сообщений серверу после `MSG_JOIN_LOGGER`, за исключением **`MSG_LEAVE_LOGGER`** при штатном завершении работы.

*   **Отключение Клиента-Логгера (обработка на сервере)**:
    *   Сервер не может пассивно обнаружить "отключение" клиента-логгера (например, если клиентский процесс аварийно завершился или возникли проблемы с сетью на стороне клиента).
    *   Удаление логгера из списка активных на сервере происходит, когда **основной поток сервера** получает от клиента-логгера **UDP-сообщение** `MSG_LEAVE_LOGGER`:
        1.  Сервер извлекает UDP-адрес отправителя `MSG_LEAVE_LOGGER`.
        2.  Поднимает мьютекс `loggers_mutex`.
        3.  Находит логгера по UDP-адресу в списке `loggers[]` и помечает его слот как неактивный (`active = 0`).
        4.  Уменьшает счетчик `active_loggers_count`.
        5.  Освобождает мьютекс `loggers_mutex`.
        6.  Сервер может разослать сообщение об отключении логгера оставшимся активным логгерам.

*   **Завершение работы Клиента-Логгера**:
    *   **По сигналу (SIGINT/SIGTERM)**:
        1.  Обработчик сигнала на клиенте-логгере устанавливает флаг `logger_client_shutdown_flag`.
        2.  Основной цикл клиента-логгера, обнаружив флаг, выходит из цикла чтения сообщений.
        3.  Клиент-логгер отправляет серверу **UDP-сообщение `MSG_LEAVE_LOGGER`** (best-effort, без ожидания ответа).
        4.  Клиент-логгер закрывает свой UDP-сокет и завершает работу.
    *   **При получении `MSG_SERVER_DOWN` от сервера**:
        1.  Клиент-логгер выводит информацию о завершении работы сервера.
        2.  Устанавливает флаг `logger_client_shutdown_flag` (или напрямую инициирует выход).
        3.  Клиент-логгер закрывает свой UDP-сокет и завершает работу (не отправляет `MSG_LEAVE_LOGGER`, так как сервер и так завершается).
    *   **При ошибке получения ответа на `MSG_JOIN_LOGGER` (например, таймаут)**:
        1.  Клиент-логгер выводит сообщение об ошибке.
        2.  Закрывает свой UDP-сокет и завершает работу.